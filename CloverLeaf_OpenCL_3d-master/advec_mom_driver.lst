


PGF90 (Version     13.5)          07/18/2014  14:45:35      page 1

Switches: -noasm -nodclchk -debug -nodlines -line -list
          -idir /usr/mpi/pgi/mvapich2-1.7-qlc/include
          -idir /usr/mpi/pgi/mvapich2-1.7-qlc/include
          -inform severe -opt 2 -nosave -object -noonetrip
          -depchk on -nostandard     
          -symbol -noupcase    

Filename: advec_mom_driver.f90

(    1) !Crown Copyright 2012 AWE.
(    2) !
(    3) ! This file is part of CloverLeaf.
(    4) !
(    5) ! CloverLeaf is free software: you can redistribute it and/or modify it under 
(    6) ! the terms of the GNU General Public License as published by the 
(    7) ! Free Software Foundation, either version 3 of the License, or (at your option) 
(    8) ! any later version.
(    9) !
(   10) ! CloverLeaf is distributed in the hope that it will be useful, but 
(   11) ! WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or 
(   12) ! FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more 
(   13) ! details.
(   14) !
(   15) ! You should have received a copy of the GNU General Public License along with 
(   16) ! CloverLeaf. If not, see http://www.gnu.org/licenses/.
(   17) 
(   18) !>  @brief Momentum advection driver
(   19) !>  @author Wayne Gaudin
(   20) !>  @details Invokes the user specified momentum advection kernel.
(   21) 
(   22) MODULE advec_mom_driver_module
(   23) 
(   24) CONTAINS
(   25) 
(   26) SUBROUTINE advec_mom_driver(chunk,which_vel,direction,sweep_number)
(   27) 
(   28)   USE clover_module
(   29)   USE advec_mom_kernel_mod
(   30) 
(   31)   IMPLICIT NONE
(   32) 
(   33)   INTEGER :: chunk,which_vel,direction,sweep_number,advec_int
(   34) 
(   35)   IF(chunks(chunk)%task.EQ.parallel%task) THEN
(   36) 
(   37)     IF(use_fortran_kernels)THEN
(   38)       CALL advec_mom_kernel(chunks(chunk)%field%x_min,            &
(   39)                           chunks(chunk)%field%x_max,              &
(   40)                           chunks(chunk)%field%y_min,              &
(   41)                           chunks(chunk)%field%y_max,              &
(   42)                           chunks(chunk)%field%z_min,              &
(   43)                           chunks(chunk)%field%z_max,              &
(   44)                           chunks(chunk)%field%xvel1,              &
(   45)                           chunks(chunk)%field%yvel1,              &
(   46)                           chunks(chunk)%field%zvel1,              &
(   47)                           chunks(chunk)%field%mass_flux_x,        &
(   48)                           chunks(chunk)%field%vol_flux_x,         &
(   49)                           chunks(chunk)%field%mass_flux_y,        &
(   50)                           chunks(chunk)%field%vol_flux_y,         &






PGF90 (Version     13.5)          07/18/2014  14:45:35      page 2

(   51)                           chunks(chunk)%field%mass_flux_z,        &
(   52)                           chunks(chunk)%field%vol_flux_z,         &
(   53)                           chunks(chunk)%field%volume,             &
(   54)                           chunks(chunk)%field%density1,           &
(   55)                           chunks(chunk)%field%work_array1,        &
(   56)                           chunks(chunk)%field%work_array2,        &
(   57)                           chunks(chunk)%field%work_array3,        &
(   58)                           chunks(chunk)%field%work_array4,        &
(   59)                           chunks(chunk)%field%work_array5,        &
(   60)                           chunks(chunk)%field%work_array6,        &
(   61)                           chunks(chunk)%field%work_array7,        &
(   62)                           chunks(chunk)%field%celldx,             &
(   63)                           chunks(chunk)%field%celldy,             &
(   64)                           chunks(chunk)%field%celldz,             &
(   65)                           advect_x,                               &
(   66)                           which_vel,                              &
(   67)                           sweep_number,                           &
(   68)                           direction                               )
(   69)     ELSEIF(use_opencl_kernels)THEN
(   70) 
(   71) 	if (advect_x .eq. .true.) then
(   72) 		advec_int = 1
(   73)     	else
(   74) 		advec_int = 0
(   75)     ENDIF
(   76) 
(   77) 	CALL advec_mom_kernel_ocl(advec_int, which_vel, sweep_number, direction)
(   78)     ELSEIF(use_C_kernels)THEN
(   79)       CALL advec_mom_kernel_c(chunks(chunk)%field%x_min,          &
(   80)                           chunks(chunk)%field%x_max,              &
(   81)                           chunks(chunk)%field%y_min,              &
(   82)                           chunks(chunk)%field%y_max,              &
(   83)                           chunks(chunk)%field%z_min,              &
(   84)                           chunks(chunk)%field%z_max,              &
(   85)                           chunks(chunk)%field%xvel1,              &
(   86)                           chunks(chunk)%field%yvel1,              &
(   87)                           chunks(chunk)%field%zvel1,              &
(   88)                           chunks(chunk)%field%mass_flux_x,        &
(   89)                           chunks(chunk)%field%vol_flux_x,         &
(   90)                           chunks(chunk)%field%mass_flux_y,        &
(   91)                           chunks(chunk)%field%vol_flux_y,         &
(   92)                           chunks(chunk)%field%mass_flux_z,        &
(   93)                           chunks(chunk)%field%vol_flux_z,         &
(   94)                           chunks(chunk)%field%volume,             &
(   95)                           chunks(chunk)%field%density1,           &
(   96)                           chunks(chunk)%field%work_array1,        &
(   97)                           chunks(chunk)%field%work_array2,        &
(   98)                           chunks(chunk)%field%work_array3,        &
(   99)                           chunks(chunk)%field%work_array4,        &
(  100)                           chunks(chunk)%field%work_array5,        &
(  101)                           chunks(chunk)%field%work_array6,        &
(  102)                           chunks(chunk)%field%work_array7,        &
(  103)                           chunks(chunk)%field%celldx,             &
(  104)                           chunks(chunk)%field%celldy,             &
(  105)                           chunks(chunk)%field%celldz,             &
(  106)                           which_vel,                              &
(  107)                           sweep_number,                           &
(  108)                           direction                               )






PGF90 (Version     13.5)          07/18/2014  14:45:35      page 3

(  109)     ENDIF
(  110) 
(  111)   ENDIF
(  112) 
(  113) END SUBROUTINE advec_mom_driver
(  114) 
(  115) END MODULE advec_mom_driver_module
